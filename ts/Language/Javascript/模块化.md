
# JavaScript 模块化

## 引言

在 ECMA2005 以前，Javascript 连文件和文件之间的引用都没有关键字支持，真是名副其实的浏览器脚本语言。在那个时候，使用 jQuery 只需要在 html 中使用 `<script>` 标签引入 Jquery 文件。



只有编程语言具有模块化的功能，才能将各个功能以不同的模块拆分，合并，引用，复用。简单的说，就是大型软件不能够以一个文件存在。我们需要将能够复用的代码分散到不同的文件中。这里的怎么拆分，引用，便是一门编程语言模块化功能的实现。不同的编程语言由各自的实现，比如 c 语言使用 `#include "xx"`；scheme 使用 `(load "xx")`；Java 使用 `import xx.yy.zz`，等等。



### 术语

- 引入，编写的代码引用其他已经编写好的功能模块代码
- 导出，编写的模块代码暴露出指定的接口或者属性

现在是 2020 年，对于 Javascript 来说，最重要的加载有两种重要的实现。

- CommonJS Modules，nodejs 所使用的规范
- ECMAScript Modules，ECMA2015 提出的规范 


### 什么是 模块化



## 什么是 CommonJS Modules

CommonJs 创立的目标是为了提供在浏览器之外的 Javascript 模块单元。使用 Javascript 开发 server 端和开发浏览器端是完全不一样的环境。为了能在开发 server 端时让 JavaScript 能复用，开发人员创立了 CommonJs。

既然时 server 端的 module 单元，那么第一个想到的就是 Nodejs。没错，Nodejs 就是使用的 CommonJs 规范（ES Module 正在试验阶段）

下面就以 NodeJs 的 Module 单元介绍 CommonJs。

在 Node.js 的 module system 中，每个文件作为一个模块单元。在 Node.js 中，使用 `require` **全局方法**  和 `module.exports` 属性分别进行模块的导入和模块 API 暴露

```javascript
// math.js 
function add(x, y) {
    return x + y
}

module.exports = {
    add
}

// a.js
const math = require('./math.js')

// sum == 3
cosnt sum = math.add(1, 2) 
```

**在 Node.js 中，文件就是模块，模块就是文件吗？**

是的，在 Node.js 中，文件就是模块，模块就是文件。

**如果一个文件没有写 `module.exports` 模块导出，那么 `require()` 这个文件，返回值是什么？**

如果一个文件没有 `module.exports`，那么这个文件被其他文件






关于 Javascript，在浏览器端，实际上只有通过标签 `<script>` 在 html 页面中引用 JavaScript，以文件为单位。在 Nodejs 上，通过 `require` 和 `exports` 两个关键字进行 module 管理。ES2015 也推出了 `import` 和 `export` 关键字的 module 管理，也有其他的规范。但是最重要的是，在浏览器中只支持标签引用文件的方式。可是它一点都不好用。现在的前端方案是开发在 NodeJs 上，使用规范化的 module 管理，然后编译成浏览器能识别的 module 管理方式（文件，闭包）

在开发的时候使用方便的 module 管理方式，然后让编译器处理成浏览器能运行的代码。这样既可以提高代码的模块化又不用担心在 nodejs 使用的模块化方式浏览器不支持。这里使用类似于 Babel 的 Javascript 编译器将浏览器不能识别的 ES2015+ 代码编译成浏览器能兼容的 Javascript 代码


### CommonJs module

## 参考
- [浏览器加载 CommonJS 模块的原理与实现](https://www.ruanyifeng.com/blog/2015/05/commonjs-in-browser.html)
- [AMD 规范](https://github.com/amdjs/amdjs-api/wiki/AMD)
- [CMD 规范](https://github.com/seajs/seajs/issues/242)
- [AMD 和 CMD 的区别有哪些？](https://www.zhihu.com/question/20351507/answer/14859415)
- [seajs 和 RequireJs 异同](https://github.com/seajs/seajs/issues/277)
