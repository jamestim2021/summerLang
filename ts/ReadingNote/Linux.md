







### 什么是 Object File（目标文件）

Object File 就是编译后但未进行链接的中间文件，源代码被编译后，在 Object File 内容有下面几个

- 指令段，用于存放程序的指令
- 数据段，用于存放程序的数据，变量

对 c 源代码只编译不连接

```shell
gcc -c test.c
```

使用 objdump 查看编译的文件

```shell
objdump -h test.o
```

参考

- [编译和链接那点事<上>](https://www.0xffffff.org/2013/04/05/16-complier-and-linker-1/)
- [x86架构操作系统内核的实现](https://wiki.0xffffff.org/)
- [JamesM's kernel development tutorials](http://www.jamesmolloy.co.uk/tutorial_html/)

### 实模式和保护模式

> 实模式是Intel 80286和之后的x86兼容CPU的操作模式。实模式的特性是一个20比特的区段存储器地址空间，可以直接软件访问BIOS例程以及周边硬件，没有任何硬件等级的存储器保护观念或多任务

20 bit 地址空间也就是 1M 的寻址空间

8086 为 16 位处理器，80386 为 32 位处理器，80286 虽也是 16 位处理器，但是 80286 的寻址模式开始从“实模式”到“保护模式”过度



### X86 寻址方式

段的概念，8086 引入了段的概念，8086 的地址总线位 20 位，数据总线由 16 位，那么 1M 的地址空间被分为 16 个 64 k 的段来管理，段寄存器存放段块的起始位置

**16 位地址寻址到 1M 空间 **，左移 4 位段地址，加上 offset 偏移地址。

16 位到 20 位实地址的转换，叫做实模式。

保护模式不能从段的寄存器中获得段的起始地址，而是需要额外的转换或检查，叫做保护模式，操作系统专门使用的寄存器，用作段的转换和检查，也就是内存的管理交给了操作系统

CR0 的 PE（Protected Enable）为 1 的话就是保护模式启动，否则就是实模式。第 31 位是分页允许位 PG

保护模式，CPU 把虚地址送给 MMU，MMU 把虚地址转换成。段描述符表

- 基地址
- 界限

分段把虚地址转化成线性地址，分页把线性地址转化为物理地址

### 哈弗结构 冯诺依曼结构

冯诺依曼架构就是数据和指令都存在一块内容中，拿数据和拿指令再某种程度上是相同的。

哈弗结构则是指令存放再一个地方，数据存放再一个地方，这样 CPU 拿数据和拿指令就能并行。

但是现实生活中是冯诺依曼架构和哈弗架构共存的方式



Linux 使用的是 GUN c，汇编使用的是 at&t 的汇编格式，还有 GCC 嵌入式汇编

### 参考

- 深入理解 Linux 内核第三版第二章
- Intel 64 and IA-32 Architectures Software Developer Manuls